# νƒ€μ΄νƒ€λ‹‰ μ„λΉ„μ¤ λ¦¬ν©ν† λ§ μ”μ•½

## π“‹ μ‘μ—… κ°μ”

μ–΄μ  μ™„λ£ν• νƒ€μ΄νƒ€λ‹‰ μ„λΉ„μ¤μ μƒμ„ 10λ… μ΅°ν λ° ν†µκ³„ κΈ°λ¥μ„ μ¤λ λ³€κ²½λ νμΌ κµ¬μ΅°μ— λ§κ² μμ •ν–μµλ‹λ‹¤.

---

## π”„ λ³€κ²½ μ‚¬ν•­

### 1. νμΌ κµ¬μ΅° λ³€κ²½

**μ΄μ „ κµ¬μ΅°:**
```
app/
β”β”€β”€ main.py
β”β”€β”€ model.py          # Passenger λ¨λΈ
β”β”€β”€ service.py        # CRUD + ML νμ΄ν”„λΌμΈ
β””β”€β”€ titanic/
    β”β”€β”€ router.py
    β”β”€β”€ train.csv
    β””β”€β”€ test.csv
```

**μƒλ΅μ΄ κµ¬μ΅°:**
```
app/
β”β”€β”€ main.py
β””β”€β”€ titanic/
    β”β”€β”€ model.py              # Passenger λ¨λΈ (Pydantic)
    β”β”€β”€ titanic_dataset.py    # λ°μ΄ν„°μ…‹ ν΄λμ¤
    β”β”€β”€ titanic_method.py     # μ „μ²λ¦¬ λ©”μ„λ“
    β”β”€β”€ titanic_service.py    # CRUD + ML νμ΄ν”„λΌμΈ
    β”β”€β”€ titanic_model.py      # ML λ¨λΈ ν΄λμ¤
    β”β”€β”€ router.py             # API μ—”λ“ν¬μΈνΈ
    β”β”€β”€ train.csv
    β””β”€β”€ test.csv
```

### 2. μ£Όμ” μμ • λ‚΄μ©

#### β… `titanic_method.py` κµ¬ν„
- `new_model()`: CSV νμΌ λ΅λ“
- `create_train()`: Feature λ°μ΄ν„° μƒμ„±
- `create_label()`: Label λ°μ΄ν„° μƒμ„±

#### β… `titanic_service.py` κµ¬ν„
- **CRUD κΈ°λ¥ μ¶”κ°€:**
  - `get_all_passengers()`: λ¨λ“  μΉκ° μ΅°ν
  - `get_passenger_by_id()`: IDλ΅ μΉκ° μ΅°ν
  - `search_passengers()`: μΉκ° κ²€μƒ‰
  - `get_top_passengers_by_fare()`: μ”κΈ κΈ°μ¤€ μƒμ„ Nλ…
  - `get_statistics()`: ν†µκ³„ μ •λ³΄
  - `create_passenger()`: μΉκ° μƒμ„±
  - `update_passenger()`: μΉκ° μμ •
  - `delete_passenger()`: μΉκ° μ‚­μ 

- **ML νμ΄ν”„λΌμΈ (κΈ°μ΅΄ μ μ§€):**
  - `preprocess()`, `modeling()`, `learning()`, `evaluate()`, `submit()`

#### β… `titanic_dataset.py` ν™μ©
- λ°μ΄ν„°μ…‹ μ΄κΈ°ν™” λ° κ²½λ΅ μ„¤μ •
- DataFrame μ €μ¥ λ° κ΄€λ¦¬

#### β… `router.py` μμ •
- Import κ²½λ΅ μμ •: `app.titanic.titanic_service` β†’ `TitanicService`
- μ‘λ‹µ λ¨λΈ μμ •: `List[Passenger]` β†’ `List[Dict[str, Any]]` (μ±—λ΄‡ νΈν™)
- μ±—λ΄‡ νΈν™ μ—”λ“ν¬μΈνΈ μ¶”κ°€: `/titanic/top10`

#### β… `model.py` μƒμ„±
- Passenger Pydantic λ¨λΈ (κΈ°μ΅΄ κµ¬μ΅° μ μ§€)
- Pydantic V2 νΈν™ (`populate_by_name = True`)

#### β… API Gateway λΌμ°ν… μ¶”κ°€
- `/api/ai/titanic/**` β†’ `mlservice:9006` λΌμ°ν… μ¶”κ°€
- `RewritePath` ν•„ν„°λ΅ `/titanic/${segment}` λ³€ν™

---

## π”— μ „μ²΄ μ—°κ²° νλ¦„

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 1. μ±—λ΄‡ μ‚¬μ©μ μ…λ ¥                                              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   "νƒ€μ΄νƒ€λ‹‰ μƒμ„ 10λ… μ•λ ¤μ¤"
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 2. ν”„λ΅ νΈμ—”λ“ (page.tsx)                                        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   - ν‚¤μ›λ“ κ°μ§€: 'νƒ€μ΄νƒ€λ‹‰', 'μƒμ„' β†’ isTitanicQuery = true
   - API νΈμ¶: GET /api/titanic/top10
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 3. Next.js API Route (route.ts)                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   - κ²½λ΅ λ³€ν™: /api/titanic/top10
   - β†’ GET http://localhost:8080/api/ai/titanic/top10
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 4. API Gateway (application.yaml)                               β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   - λΌμ°ν…: /api/ai/titanic/** β†’ mlservice:9006
   - RewritePath: /api/ai/titanic/top10 β†’ /titanic/top10
   - μ‹¤μ  νΈμ¶: GET http://mlservice:9006/titanic/top10
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 5. ML Service (router.py)                                       β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   - μ—”λ“ν¬μΈνΈ: GET /titanic/top10
   - titanic_service.get_top_passengers_by_fare(top_n=10) νΈμ¶
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 6. Titanic Service (titanic_service.py)                         β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   - dataset.trainμ—μ„ λ°μ΄ν„° λ΅λ“
   - μ”κΈ κΈ°μ¤€ λ‚΄λ¦Όμ°¨μ μ •λ ¬
   - μƒμ„ 10λ… μ¶”μ¶
   - λ”•μ…”λ„λ¦¬ λ¦¬μ¤νΈ λ°ν™
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 7. Router μ‘λ‹µ ν¬λ§·ν…                                            β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   - {passengers: [...], count: 10} ν•μ‹μΌλ΅ λ³€ν™
   - JSON μ‘λ‹µ λ°ν™
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 8. ν”„λ΅ νΈμ—”λ“ μ‘λ‹µ μ²λ¦¬ (page.tsx)                              β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
   - data.passengersμ™€ data.count νμ‹±
   - λ§ν¬λ‹¤μ΄ ν•μ‹μΌλ΅ ν¬λ§·ν…
   - μ±—λ΄‡ UIμ— ν‘μ‹
```

---

## π“ μ£Όμ” μ—”λ“ν¬μΈνΈ

### μ±—λ΄‡ νΈν™ μ—”λ“ν¬μΈνΈ

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μ„¤λ… | μ±—λ΄‡ νΈμ¶ |
|-----------|--------|------|----------|
| `/titanic/top10` | GET | μƒμ„ 10λ… μ΅°ν | β… |
| `/titanic/stats` | GET | ν†µκ³„ μ •λ³΄ | β… |

### RESTful API μ—”λ“ν¬μΈνΈ

| μ—”λ“ν¬μΈνΈ | λ©”μ„λ“ | μ„¤λ… |
|-----------|--------|------|
| `/titanic/passengers` | GET | λ¨λ“  μΉκ° μ΅°ν |
| `/titanic/passengers/{id}` | GET | νΉμ • μΉκ° μ΅°ν |
| `/titanic/passengers/search` | GET | μΉκ° κ²€μƒ‰ |
| `/titanic/passengers/top/{n}` | GET | μƒμ„ Nλ… μ΅°ν |
| `/titanic/passengers` | POST | μΉκ° μƒμ„± |
| `/titanic/passengers/{id}` | PUT | μΉκ° μμ • |
| `/titanic/passengers/{id}` | PATCH | μΉκ° λ¶€λ¶„ μμ • |
| `/titanic/passengers/{id}` | DELETE | μΉκ° μ‚­μ  |

---

## π”§ μμ •λ νμΌ λ©λ΅

### 1. `titanic_method.py` (μ‹ κ· κµ¬ν„)
- CSV νμΌ λ΅λ“ λ©”μ„λ“
- Feature/Label λ¶„λ¦¬ λ©”μ„λ“

### 2. `titanic_service.py` (CRUD κΈ°λ¥ μ¶”κ°€)
- λ°μ΄ν„° λ΅λ“ λ° μ΄κΈ°ν™”
- CRUD μ‘μ—… λ©”μ„λ“
- ν†µκ³„ λ° κ²€μƒ‰ λ©”μ„λ“

### 3. `model.py` (μ‹ κ· μƒμ„±)
- Passenger Pydantic λ¨λΈ

### 4. `router.py` (μμ •)
- Import κ²½λ΅ μμ •
- μ‘λ‹µ λ¨λΈ μμ •
- μ±—λ΄‡ νΈν™ μ—”λ“ν¬μΈνΈ μ¶”κ°€

### 5. `api.kroaddy.site/gateway/src/main/resources/application.yaml` (μμ •)
- `/api/ai/titanic/**` λΌμ°ν… μ¶”κ°€

---

## β… ν…μ¤νΈ λ°©λ²•

### 1. Swagger UI ν…μ¤νΈ

```bash
# μ„λ²„ μ‹¤ν–‰ ν›„
http://localhost:9006/docs
```

**ν…μ¤νΈν•  μ—”λ“ν¬μΈνΈ:**
- `GET /titanic/top10` - μƒμ„ 10λ… μ΅°ν
- `GET /titanic/stats` - ν†µκ³„ μ •λ³΄

### 2. Postman ν…μ¤νΈ

```bash
# μƒμ„ 10λ… μ΅°ν
GET http://localhost:9006/titanic/top10

# ν†µκ³„ μ΅°ν
GET http://localhost:9006/titanic/stats
```

### 3. μ±—λ΄‡ ν…μ¤νΈ

1. ν”„λ΅ νΈμ—”λ“ μ‹¤ν–‰: `http://localhost:3000`
2. μ±—λ΄‡μ— μ…λ ¥:
   - "νƒ€μ΄νƒ€λ‹‰ μƒμ„ 10λ… μ•λ ¤μ¤"
   - "νƒ€μ΄νƒ€λ‹‰ ν†µκ³„ μ•λ ¤μ¤"

---

## π― ν•µμ‹¬ ν¬μΈνΈ

### 1. κµ¬μ΅° μ μ§€
- β… κΈ°μ΅΄ νμΌ κµ¬μ΅°λ¥Ό λ³€κ²½ν•μ§€ μ•μ
- β… λ‹¤λ¥Έ CSV λ°μ΄ν„°μ…‹ μ¶”κ°€ μ‹ λ™μΌν• κµ¬μ΅° μ‚¬μ© κ°€λ¥

### 2. μ±—λ΄‡ νΈν™μ„±
- β… μ–΄μ μ™€ λ™μΌν• μ‘λ‹µ ν•μ‹ μ μ§€
- β… `/titanic/top10` μ—”λ“ν¬μΈνΈ μ¶”κ°€
- β… `{passengers: [...], count: N}` ν•μ‹ λ°ν™

### 3. ν™•μ¥μ„±
- β… μƒλ΅μ΄ λ°μ΄ν„°μ…‹ μ¶”κ°€ μ‹ λ™μΌν• ν¨ν„΄ μ μ©
- β… ML νμ΄ν”„λΌμΈ κµ¬μ΅° μ μ§€

---

## π“ μ‘λ‹µ ν•μ‹

### μƒμ„ 10λ… μ΅°ν μ‘λ‹µ

```json
{
  "passengers": [
    {
      "PassengerId": 1,
      "Survived": 0,
      "Pclass": 3,
      "Name": "Braund, Mr. Owen Harris",
      "Sex": "male",
      "Age": 22.0,
      "SibSp": 1,
      "Parch": 0,
      "Ticket": "A/5 21171",
      "Fare": 7.25,
      "Cabin": null,
      "Embarked": "S"
    },
    ...
  ],
  "count": 10
}
```

### ν†µκ³„ μ΅°ν μ‘λ‹µ

```json
{
  "total_passengers": 891,
  "survived": 342,
  "died": 549,
  "survival_rate": 38.38,
  "average_fare": 32.20,
  "average_age": 29.70
}
```

---

## π€ λ‹¤μ λ‹¨κ³„

1. **μ„λ²„ μ¬μ‹μ‘**
   ```bash
   docker compose restart mlservice api-gateway
   ```

2. **ν…μ¤νΈ**
   - Swagger UIμ—μ„ μ—”λ“ν¬μΈνΈ ν…μ¤νΈ
   - μ±—λ΄‡μ—μ„ μ‹¤μ  μ‚¬μ© ν…μ¤νΈ

3. **λ‹¤λ¥Έ λ°μ΄ν„°μ…‹ μ¶”κ°€**
   - λ™μΌν• κµ¬μ΅°λ΅ μƒ λ°μ΄ν„°μ…‹ λ¨λ“ μƒμ„±
   - `titanic_*` νμΌλ“¤μ„ `{dataset}_*`λ΅ λ³µμ‚¬ ν›„ μμ •

---

**μ‘μ„±μΌ**: 2024-12-05  
**λ²„μ „**: 1.0.0  
**μ‘μ„±μ**: ML Service Team

