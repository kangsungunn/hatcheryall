# ì„œìš¸ ë²”ì£„ ë°ì´í„° ë¶„ì„ í”„ë¡œì íŠ¸ ì™„ë²½ ê°€ì´ë“œ (2024.12.10)

> ğŸ¯ **í”„ë¡œì íŠ¸ ëª©í‘œ**: ì„œìš¸ì‹œ CCTV, ì¸êµ¬, ë²”ì£„ ë°ì´í„°ë¥¼ í†µí•©í•˜ì—¬ ë²”ì£„ìœ¨ê³¼ ê²€ê±°ìœ¨ì„ ë¶„ì„í•˜ê³ , ì‹œê°í™” íˆíŠ¸ë§µì„ ì œê³µí•˜ëŠ” RESTful API êµ¬ì¶•

## ğŸ“š Table of Contents
1. [í”„ë¡œì íŠ¸ ê°œìš”](#-í”„ë¡œì íŠ¸-ê°œìš”)
2. [ì‚¬ì „ ì¤€ë¹„](#-ì‚¬ì „-ì¤€ë¹„)
3. [ë‹¨ê³„ë³„ êµ¬í˜„](#-ë‹¨ê³„ë³„-êµ¬í˜„)
4. [íˆíŠ¸ë§µ ìƒì„±](#-íˆíŠ¸ë§µ-ìƒì„±)
5. [íŠ¸ëŸ¬ë¸”ìŠˆíŒ…](#-íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)
6. [í•™ìŠµ ì •ë¦¬](#-í•™ìŠµ-ì •ë¦¬)

---

## ğŸŒŸ í”„ë¡œì íŠ¸ ê°œìš”

### ë¬´ì—‡ì„ ë§Œë“œë‚˜ìš”?
ì„œìš¸ì‹œì˜ ìì¹˜êµ¬ë³„ ë²”ì£„ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì—¬:
- **ë²”ì£„ìœ¨ íˆíŠ¸ë§µ**: ì¸êµ¬ 10ë§Œëª…ë‹¹ ë²”ì£„ ë°œìƒ ê±´ìˆ˜ë¥¼ ì‹œê°í™”
- **ê²€ê±°ìœ¨ íˆíŠ¸ë§µ**: ë²”ì£„ ìœ í˜•ë³„ ê²€ê±°ìœ¨(%)ì„ ì‹œê°í™”
- **í†µí•© ë°ì´í„°ì…‹**: CCTV, ì¸êµ¬, ë²”ì£„ ë°ì´í„°ë¥¼ í•˜ë‚˜ë¡œ í•©ì¹œ CSV íŒŒì¼

### ì™œ ì´ í”„ë¡œì íŠ¸ê°€ ì¤‘ìš”í•œê°€ìš”?
1. **ì‹¤ë¬´ ë°ì´í„° ì²˜ë¦¬ ê²½í—˜**: ì—¬ëŸ¬ ì¶œì²˜ì˜ ë°ì´í„°ë¥¼ ì •ì œí•˜ê³  í†µí•©í•˜ëŠ” ê³¼ì •
2. **API ì„¤ê³„**: RESTful API ì„¤ê³„ ë° API Gateway íŒ¨í„´ í•™ìŠµ
3. **ì‹œê°í™”**: ë³µì¡í•œ ë°ì´í„°ë¥¼ ì§ê´€ì ì¸ íˆíŠ¸ë§µìœ¼ë¡œ í‘œí˜„
4. **ì™¸ë¶€ API ì—°ë™**: Kakao Map APIë¥¼ í™œìš©í•œ ì§€ë¦¬ ì •ë³´ ìˆ˜ì§‘

### ê¸°ìˆ  ìŠ¤íƒ
- **Backend**: FastAPI (Python 3.11)
- **Data Processing**: Pandas, NumPy
- **Visualization**: Matplotlib, Seaborn
- **External API**: Kakao Map API
- **Infrastructure**: Docker, Docker Compose
- **API Gateway**: Spring Cloud Gateway

---

## ğŸ›  ì‚¬ì „ ì¤€ë¹„

### 1. í•„ìš”í•œ ë°ì´í„° íŒŒì¼
í”„ë¡œì íŠ¸ë¥¼ ì‹œì‘í•˜ê¸° ì „ì— ë‹¤ìŒ íŒŒì¼ë“¤ì„ ì¤€ë¹„í•©ë‹ˆë‹¤:

```
ai.kroaddy.site/services/mlservice/app/seoul_crime/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ cctv.csv          # ì„œìš¸ì‹œ ìì¹˜êµ¬ë³„ CCTV ì„¤ì¹˜ í˜„í™©
â”‚   â”œâ”€â”€ pop.xlsx          # ì„œìš¸ì‹œ ìì¹˜êµ¬ë³„ ì¸êµ¬ ë°ì´í„°
â”‚   â””â”€â”€ crime.csv         # ì„œìš¸ì‹œ ê²½ì°°ì„œë³„ ë²”ì£„ ë°œìƒ/ê²€ê±° ê±´ìˆ˜
â””â”€â”€ save/                 # ì²˜ë¦¬ëœ ê²°ê³¼ ì €ì¥ í´ë” (ìë™ ìƒì„±)
```

**ë°ì´í„° êµ¬ì¡° ì´í•´í•˜ê¸°**:
- `cctv.csv`: ìì¹˜êµ¬ë³„ CCTV ì„¤ì¹˜ ëŒ€ìˆ˜ (2013~2016ë…„)
- `pop.xlsx`: ìì¹˜êµ¬ë³„ ì¸êµ¬ìˆ˜
- `crime.csv`: ê²½ì°°ì„œë³„ 5ëŒ€ ë²”ì£„(ì‚´ì¸, ê°•ë„, ê°•ê°„, ì ˆë„, í­ë ¥) ë°œìƒ/ê²€ê±° ê±´ìˆ˜

### 2. Kakao Map API í‚¤ ë°œê¸‰
1. [Kakao Developers](https://developers.kakao.com/)ì— ì ‘ì†
2. ë‚´ ì• í”Œë¦¬ì¼€ì´ì…˜ â†’ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¶”ê°€í•˜ê¸°
3. ì•± ì„¤ì • â†’ ì•± í‚¤ì—ì„œ **REST API í‚¤** ë³µì‚¬
4. `.env` íŒŒì¼ì— ì¶”ê°€:

```bash
KAKAO_REST_API_KEY=your_api_key_here
```

**ì™œ Kakao Map APIë¥¼ ì‚¬ìš©í•˜ë‚˜ìš”?**
- Google Maps APIë³´ë‹¤ í•œêµ­ ì§€ëª… ê²€ìƒ‰ì´ ì •í™•í•¨
- ê²½ì°°ì„œ ì´ë¦„ìœ¼ë¡œ ì£¼ì†Œì™€ ì¢Œí‘œë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìˆìŒ
- í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ Kakao ì„œë¹„ìŠ¤ë¥¼ í†µí•© ì‚¬ìš©

### 3. ê°œë°œ í™˜ê²½ ì„¤ì •
```yaml
# docker-compose.yamlì— ì„œë¹„ìŠ¤ ì„¤ì • í™•ì¸
mlservice:
  environment:
    - KAKAO_REST_API_KEY=${KAKAO_REST_API_KEY:-}
  volumes:
    - ./ai.kroaddy.site/services/mlservice/app/seoul_crime/save:/app/app/seoul_crime/save
```

**Volume ë§ˆìš´íŠ¸ê°€ ì¤‘ìš”í•œ ì´ìœ **:
- ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ìƒì„±í•œ íŒŒì¼ì„ í˜¸ìŠ¤íŠ¸ì—ì„œë„ ë³¼ ìˆ˜ ìˆìŒ
- ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ ì‹œì—ë„ ë°ì´í„° ìœ ì§€

---

## ğŸ¯ ë‹¨ê³„ë³„ êµ¬í˜„

### 1ë‹¨ê³„: í”„ë¡œì íŠ¸ êµ¬ì¡° ì´í•´í•˜ê¸°

#### 1.1 ì™œ OOP(ê°ì²´ì§€í–¥)ë¡œ ì„¤ê³„í•˜ë‚˜ìš”?
ë°ì´í„° ë¶„ì„ í”„ë¡œì íŠ¸ë¥¼ 3ê°œ ë ˆì´ì–´ë¡œ ë¶„ë¦¬í•˜ë©´:
- **Data Layer** (`seoul_data.py`): ë°ì´í„° ì €ì¥ì†Œ ì—­í• 
- **Method Layer** (`seoul_method.py`): ë°ì´í„° ì²˜ë¦¬ ë¡œì§
- **Service Layer** (`seoul_service.py`): ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì¡°í•©
- **Router Layer** (`seoul_router.py`): API ì—”ë“œí¬ì¸íŠ¸

**ì¥ì **:
- ê° ë ˆì´ì–´ì˜ ì±…ì„ì´ ëª…í™•í•¨
- í…ŒìŠ¤íŠ¸ì™€ ìœ ì§€ë³´ìˆ˜ê°€ ì‰¬ì›€
- ì½”ë“œ ì¬ì‚¬ìš©ì„± í–¥ìƒ

#### 1.2 ë°ì´í„° ì €ì¥ì†Œ ì„¤ê³„ (`seoul_data.py`)

**íŒŒì¼ ìœ„ì¹˜**: `app/seoul_crime/seoul_data.py`

```python
from dataclasses import dataclass
from pathlib import Path
import pandas as pd

@dataclass
class SeoulData(object):
    _fname: str = ''
    _dname: str = str(Path(__file__).parent / 'data')  # data í´ë” ê²½ë¡œ
    _sname: str = str(Path(__file__).parent / 'save')  # save í´ë” ê²½ë¡œ
    _cctv: pd.DataFrame = None
    _crime: pd.DataFrame = None
    _pop: pd.DataFrame = None
    _merged_cctv_pop: pd.DataFrame = None

    @property
    def cctv(self) -> pd.DataFrame: return self._cctv
    
    @cctv.setter
    def cctv(self, cctv): self._cctv = cctv
    
    # ... (ë‹¤ë¥¸ property/setterë„ ë™ì¼ íŒ¨í„´)
```

**ğŸ’¡ ì™œ ì´ë ‡ê²Œ ì‘ì„±í•˜ë‚˜ìš”?**

1. **`Path(__file__).parent / 'data'`**: 
   - `__file__`ì€ í˜„ì¬ íŒŒì¼ì˜ ì ˆëŒ€ ê²½ë¡œ
   - `.parent`ëŠ” ìƒìœ„ ë””ë ‰í† ë¦¬ (`seoul_crime/`)
   - `/` ì—°ì‚°ìë¡œ ê²½ë¡œ ê²°í•© (OS ë…ë¦½ì )
   - **ì¥ì **: ì–´ë””ì„œ ì‹¤í–‰í•´ë„ ì˜¬ë°”ë¥¸ ê²½ë¡œë¥¼ ì°¾ìŒ

2. **`pd.DataFrame` íƒ€ì… íŒíŒ…**:
   - IDE ìë™ì™„ì„± ì§€ì›
   - íƒ€ì… ì²´í¬ë¡œ ë²„ê·¸ ì˜ˆë°©

3. **Property/Setter íŒ¨í„´**:
   - ì™¸ë¶€ì—ì„œëŠ” `service.data.cctv`ì²˜ëŸ¼ ì ‘ê·¼
   - ë‚´ë¶€ì ìœ¼ë¡œëŠ” `_cctv` private ë³€ìˆ˜ ë³´í˜¸
   - ë‚˜ì¤‘ì— ìœ íš¨ì„± ê²€ì‚¬ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥

---

### 2ë‹¨ê³„: ë°ì´í„° ì²˜ë¦¬ ë©”ì„œë“œ êµ¬í˜„í•˜ê¸°

#### 2.1 íŒŒì¼ ë¡œë” ë§Œë“¤ê¸° (`seoul_method.py`)

**íŒŒì¼ ìœ„ì¹˜**: `app/seoul_crime/seoul_method.py`

```python
class SeoulMethod:
    def csv_to_df(self, fname: str) -> pd.DataFrame:
        """CSV íŒŒì¼ì„ DataFrameìœ¼ë¡œ ë³€í™˜"""
        return pd.read_csv(fname)
    
    def xlsx_to_df(self, fname: str) -> pd.DataFrame:
        """Excel íŒŒì¼ì„ DataFrameìœ¼ë¡œ ë³€í™˜"""
        return pd.read_excel(fname)
```

**ğŸ’¡ ì™œ ê°„ë‹¨í•œ í•¨ìˆ˜ë„ ë©”ì„œë“œë¡œ ë§Œë“œë‚˜ìš”?**
- ë‚˜ì¤‘ì— ì¸ì½”ë”© ì²˜ë¦¬, ì—ëŸ¬ í•¸ë“¤ë§ ë“±ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŒ
- ì¼ê´€ëœ ì¸í„°í˜ì´ìŠ¤ ì œê³µ
- í…ŒìŠ¤íŠ¸ ì‹œ ëª©(mock) ê°ì²´ë¡œ êµì²´ ê°€ëŠ¥

#### 2.2 ë°ì´í„° ì „ì²˜ë¦¬ ì´í•´í•˜ê¸°

**CCTV ë°ì´í„° ì „ì²˜ë¦¬**:
```python
cctv = self.method.csv_to_df(str(cctv_path))
# ì—°ë„ë³„ ì„¤ì¹˜ ëŒ€ìˆ˜ëŠ” í•„ìš” ì—†ìŒ â†’ ì´í•©ë§Œ ì‚¬ìš©
cctv = cctv.drop(['2013ë…„ë„ ì´ì „','2014ë…„','2015ë…„','2016ë…„'], axis=1)
```

**ê²°ê³¼**:
```
ê¸°ê´€ëª…    ì†Œê³„
ê°•ë‚¨êµ¬    2780
ê°•ë™êµ¬    773
...
```

**ì¸êµ¬ ë°ì´í„° ì „ì²˜ë¦¬ (ë³µì¡í•œ ë¶€ë¶„)**:

ì›ë³¸ ë°ì´í„° êµ¬ì¡°ë¥¼ ì´í•´í•´ì•¼ í•©ë‹ˆë‹¤:
```
        ìì¹˜êµ¬ëª…    ì¸êµ¬    ...    ì™¸êµ­ì¸ ì£¼ë¯¼ë“±ë¡ ì¸êµ¬
0       í•©ê³„      ...
1       ì†Œê³„      ...
2       (ì—¬ê¸°ì„œë¶€í„° ì‹¤ì œ ë°ì´í„°)
3       ì¢…ë¡œêµ¬    157834
4       ì¤‘êµ¬      125709
...
```

ë¬¸ì œì :
- ì»¬ëŸ¼ì´ ë„ˆë¬´ ë§ìŒ (ìì¹˜êµ¬ëª…ê³¼ ì´ ì¸êµ¬ìˆ˜ë§Œ í•„ìš”)
- ìƒìœ„ 3ê°œ í–‰ì´ í—¤ë”/í•©ê³„ ì •ë³´

í•´ê²°:
```python
# 1ë‹¨ê³„: í•„ìš”í•œ ì»¬ëŸ¼ë§Œ ì„ íƒ (ì¸ë±ìŠ¤ 1=ìì¹˜êµ¬ëª…, ì¸ë±ìŠ¤ 3=ì´ ì¸êµ¬)
col_3_name = pop.columns[3] if len(pop.columns) > 3 else pop.columns[-1]
pop = pop.iloc[:, [1, 3]]

# 2ë‹¨ê³„: ì»¬ëŸ¼ëª… ëª…í™•í•˜ê²Œ ì§€ì •
pop.columns = ['ìì¹˜êµ¬', col_3_name]

# 3ë‹¨ê³„: ë¶ˆí•„ìš”í•œ í–‰ ì œê±° (ì¸ë±ìŠ¤ 1, 2, 3 = í•©ê³„, ì†Œê³„, ë¹ˆ í–‰)
pop = pop.drop([1, 2, 3], axis=0)

# 4ë‹¨ê³„: ì¸ë±ìŠ¤ ì¬ì„¤ì • (0ë¶€í„° ë‹¤ì‹œ ì‹œì‘)
pop = pop.reset_index(drop=True)
```

**ê²°ê³¼**:
```
ìì¹˜êµ¬    ì¸êµ¬
ê°•ë‚¨êµ¬    570500
ê°•ë™êµ¬    440359
...
```

---

### 3ë‹¨ê³„: Kakao Map APIë¡œ ê²½ì°°ì„œ ìœ„ì¹˜ ì°¾ê¸°

#### 3.1 ì™œ Kakao Map APIê°€ í•„ìš”í•œê°€ìš”?

ë²”ì£„ ë°ì´í„°ëŠ” **ê²½ì°°ì„œ ë‹¨ìœ„**ì¸ë°, ë‹¤ë¥¸ ë°ì´í„°ëŠ” **ìì¹˜êµ¬ ë‹¨ìœ„**ì…ë‹ˆë‹¤:
- ê°•ë‚¨êµ¬ì—ëŠ” "ê°•ë‚¨ê²½ì°°ì„œ", "ìˆ˜ì„œê²½ì°°ì„œ" 2ê°œ ì¡´ì¬
- ë¬¸ì œ: ë²”ì£„ ë°ì´í„°ì˜ "ê´€ì„œëª…"ìœ¼ë¡œëŠ” ì–´ëŠ ìì¹˜êµ¬ì¸ì§€ ì•Œ ìˆ˜ ì—†ìŒ
- í•´ê²°: ê²½ì°°ì„œ ì£¼ì†Œë¥¼ ê²€ìƒ‰í•´ì„œ ìì¹˜êµ¬ ì¶”ì¶œ

#### 3.2 Singleton íŒ¨í„´ ì´í•´í•˜ê¸° (`kakao_map_singleton.py`)

**ì™œ Singleton íŒ¨í„´ì„ ì‚¬ìš©í•˜ë‚˜ìš”?**
- API í´ë¼ì´ì–¸íŠ¸ëŠ” ì—¬ëŸ¬ ë²ˆ ìƒì„±í•  í•„ìš” ì—†ìŒ
- API í‚¤ ë¡œë“œë„ í•œ ë²ˆë§Œ ìˆ˜í–‰
- ë©”ëª¨ë¦¬ ì ˆì•½

```python
class KakaoMapSingleton:
    _instance = None  # í´ë˜ìŠ¤ ë³€ìˆ˜: ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ê°€ ê³µìœ 
    
    def __new__(cls):
        """ê°ì²´ ìƒì„± ì‹œ ìë™ í˜¸ì¶œ"""
        if cls._instance is None:  # ì²« ìƒì„±ì¼ ë•Œë§Œ
            cls._instance = super(KakaoMapSingleton, cls).__new__(cls)
            cls._instance._api_key = cls._instance._retrieve_api_key()
            cls._instance._keyword_url = "https://dapi.kakao.com/v2/local/search/keyword.json"
        return cls._instance  # ì´ë¯¸ ìƒì„±ëœ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜
```

**ì‚¬ìš©ë²•**:
```python
# ì²« ë²ˆì§¸ í˜¸ì¶œ: ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
gmaps1 = KakaoMapSingleton()

# ë‘ ë²ˆì§¸ í˜¸ì¶œ: ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ ë°˜í™˜
gmaps2 = KakaoMapSingleton()

# gmaps1 is gmaps2 â†’ True (ë™ì¼í•œ ê°ì²´)
```

#### 3.3 ê²½ì°°ì„œ ì£¼ì†Œ ê²€ìƒ‰ ë° ìì¹˜êµ¬ ì¶”ì¶œ

**ì „ì²´ íë¦„**:
1. ê²½ì°°ì„œ ì´ë¦„ í¬ë§· ë³€í™˜: `"ê°•ë‚¨ì„œ"` â†’ `"ì„œìš¸ê°•ë‚¨ê²½ì°°ì„œ"`
2. Kakao APIë¡œ ì£¼ì†Œ ê²€ìƒ‰
3. ì£¼ì†Œì—ì„œ ìì¹˜êµ¬ ì¶”ì¶œ: `"ì„œìš¸ ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™ 998"` â†’ `"ê°•ë‚¨êµ¬"`

```python
# 1ë‹¨ê³„: ê²½ì°°ì„œ ì´ë¦„ ë³€í™˜
station_names = ['ì„œìš¸' + str(name[:-1]) + 'ê²½ì°°ì„œ' for name in crime['ê´€ì„œëª…']]
# ["ê°•ë‚¨ì„œ", "ìˆ˜ì„œì„œ", ...] â†’ ["ì„œìš¸ê°•ë‚¨ê²½ì°°ì„œ", "ì„œìš¸ìˆ˜ì„œê²½ì°°ì„œ", ...]

# 2ë‹¨ê³„: ê° ê²½ì°°ì„œ ì£¼ì†Œ ê²€ìƒ‰
station_addrs = []
for name in station_names:
    tmp = gmaps.geocode(name, language='ko')
    if tmp and len(tmp) > 0:
        addr = tmp[0].get("formatted_address")
        station_addrs.append(addr)
        print(f"âœ“ {name}: {addr}")
    else:
        station_addrs.append(None)
        print(f"âœ— {name}: ê²€ìƒ‰ ì‹¤íŒ¨")

# 3ë‹¨ê³„: ì£¼ì†Œì—ì„œ ìì¹˜êµ¬ ì¶”ì¶œ
gu_names = []
for addr in station_addrs:
    if addr:
        # "ì„œìš¸ ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™ 998" â†’ ["ì„œìš¸", "ê°•ë‚¨êµ¬", "ëŒ€ì¹˜ë™", "998"]
        tmp = addr.split()
        # "êµ¬"ë¡œ ëë‚˜ëŠ” ë‹¨ì–´ ì°¾ê¸°
        tmp_gu = [gu for gu in tmp if gu[-1] == 'êµ¬']
        gu_names.append(tmp_gu[0] if tmp_gu else None)
    else:
        gu_names.append(None)

# 4ë‹¨ê³„: ë²”ì£„ ë°ì´í„°ì— ì¶”ê°€
crime['ìì¹˜êµ¬'] = gu_names
crime['ê²½ì°°ì„œì£¼ì†Œ'] = station_addrs
```

**ğŸ’¡ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… íŒ**:
- **ë¬¸ì œ**: "ê²½ì°°ì„œì˜ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"
- **ì›ì¸**: Address Search APIëŠ” ê±´ë¬¼ëª… ê²€ìƒ‰ ë¶ˆê°€
- **í•´ê²°**: Keyword Search API ì‚¬ìš© (`/v2/local/search/keyword.json`)

---

### 4ë‹¨ê³„: FastAPI ì—”ë“œí¬ì¸íŠ¸ ë§Œë“¤ê¸°

#### 4.1 ë¼ìš°í„° ì„¤ê³„ (`seoul_router.py`)

**íŒŒì¼ ìœ„ì¹˜**: `app/seoul_crime/seoul_router.py`

```python
from fastapi import APIRouter, HTTPException
from app.seoul_crime.seoul_service import SeoulService

router = APIRouter(prefix="/seoul", tags=["seoul"])
seoul_service = SeoulService()

@router.get("/preprocess")
async def run_preprocess():
    """ë°ì´í„° ì „ì²˜ë¦¬ ë° í†µí•© ì‹¤í–‰"""
    try:
        result = seoul_service.preprocess()
        return {"status": "success", "data": result}
    except Exception as e:
        raise HTTPException(status_code=500, detail=str(e))
```

**ğŸ’¡ ë¼ìš°í„° ì„¤ê³„ ì›ì¹™**:
- `prefix="/seoul"`: ëª¨ë“  ì—”ë“œí¬ì¸íŠ¸ê°€ `/seoul/...`ë¡œ ì‹œì‘
- `tags=["seoul"]`: Swagger ë¬¸ì„œì—ì„œ ê·¸ë£¹í™”
- `async def`: ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì„±ëŠ¥ í–¥ìƒ
- ì—ëŸ¬ í•¸ë“¤ë§: ì˜ˆì™¸ ë°œìƒ ì‹œ 500 ì—ëŸ¬ ë°˜í™˜

#### 4.2 API Gateway ì—°ë™ ì´í•´í•˜ê¸°

**ì§ì ‘ ì ‘ê·¼ vs Gateway ì ‘ê·¼**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€ ì§ì ‘ ì ‘ê·¼: http://localhost:9006/seoul/preprocess
       â”‚  (ê°œë°œ ì¤‘ì—ë§Œ ì‚¬ìš©, ì™¸ë¶€ì— í¬íŠ¸ 9006 ë…¸ì¶œ í•„ìš”)
       â”‚
       â””â”€ Gateway ì ‘ê·¼: http://localhost:8080/api/ai/seoul/preprocess âœ…
          (ìš´ì˜ í™˜ê²½ ê¶Œì¥, ë‹¨ì¼ ì§„ì…ì , ë³´ì•ˆ ê°•í™”)
```

**API Gateway ì„¤ì •** (`application.yaml`):
```yaml
- id: seoul-service-route
  uri: http://mlservice:9006  # Docker ë„¤íŠ¸ì›Œí¬ ë‚´ë¶€ ì£¼ì†Œ
  predicates:
    - Path=/api/ai/seoul/**   # ì´ íŒ¨í„´ ë§¤ì¹­ ì‹œ ë¼ìš°íŒ…
  filters:
    - RewritePath=/api/ai/seoul/(?<segment>.*), /seoul/${segment}
      # /api/ai/seoul/preprocess â†’ /seoul/preprocessë¡œ ë³€í™˜
```

**ğŸ’¡ Gatewayì˜ ì¥ì **:
1. **ì¤‘ì•™ ì§‘ì¤‘ì‹ ê´€ë¦¬**: í•˜ë‚˜ì˜ URLë§Œ ê³µê°œ
2. **ë³´ì•ˆ**: ë‚´ë¶€ ì„œë¹„ìŠ¤ í¬íŠ¸ ìˆ¨ê¹€
3. **ì¸ì¦/ì¸ê°€**: JWT í† í° ê²€ì¦ì„ Gatewayì—ì„œ ì¼ê´„ ì²˜ë¦¬
4. **ë¡œë“œ ë°¸ëŸ°ì‹±**: íŠ¸ë˜í”½ ë¶„ì‚°
5. **ë¡œê¹…/ëª¨ë‹ˆí„°ë§**: ëª¨ë“  ìš”ì²­ ê¸°ë¡

---

### 5ë‹¨ê³„: ë°ì´í„° í†µí•© (Merge)

#### 5.1 Merge ì „ëµ ì´í•´í•˜ê¸°

**3ê°€ì§€ Merge ë°©ì‹**:
```python
# Inner Join: ì–‘ìª½ ëª¨ë‘ ìˆëŠ” ë°ì´í„°ë§Œ (êµì§‘í•©)
merge(left, right, how='inner')  # âœ… ìš°ë¦¬ê°€ ì‚¬ìš©

# Left Join: ì™¼ìª½ ë°ì´í„° ì „ì²´ ìœ ì§€ (ì™¼ìª½ ê¸°ì¤€)
merge(left, right, how='left')

# Outer Join: ì–‘ìª½ ë°ì´í„° ëª¨ë‘ ìœ ì§€ (í•©ì§‘í•©)
merge(left, right, how='outer')
```

**ì™œ Inner Joinì„ ì„ íƒí–ˆë‚˜ìš”?**
- CCTV, ì¸êµ¬, ë²”ì£„ ë°ì´í„°ê°€ ëª¨ë‘ ìˆëŠ” ìì¹˜êµ¬ë§Œ ë¶„ì„
- ë¶ˆì™„ì „í•œ ë°ì´í„° ì œì™¸ â†’ ë¶„ì„ ì •í™•ë„ í–¥ìƒ

#### 5.2 CCTV + ì¸êµ¬ Merge

```python
merged = self.method.df_merge(
    left=cctv,        # ì™¼ìª½ DataFrame
    right=pop,        # ì˜¤ë¥¸ìª½ DataFrame
    left_on='ê¸°ê´€ëª…',  # ì™¼ìª½ ì¡°ì¸ í‚¤
    right_on='ìì¹˜êµ¬', # ì˜¤ë¥¸ìª½ ì¡°ì¸ í‚¤
    how='inner'       # Inner Join
)
```

**ê²°ê³¼** (ì¼ë¶€ ì»¬ëŸ¼):
```
ê¸°ê´€ëª…    ì†Œê³„    ìì¹˜êµ¬    ì¸êµ¬
ê°•ë‚¨êµ¬    2780    ê°•ë‚¨êµ¬    570500
ê°•ë™êµ¬    773     ê°•ë™êµ¬    440359
...
```

**ì»¬ëŸ¼ëª… prefix ì¶”ê°€ (ì™œ í•„ìš”í•œê°€ìš”?)**:
- ë‚˜ì¤‘ì— ì—¬ëŸ¬ ë°ì´í„°ë¥¼ í•©ì¹  ë•Œ ì»¬ëŸ¼ëª… ì¶©ëŒ ë°©ì§€
- ë°ì´í„° ì¶œì²˜ë¥¼ ëª…í™•í•˜ê²Œ í‘œì‹œ

```python
# CCTV ì»¬ëŸ¼ì— CCTV_ prefix
merged = merged.rename(columns={'ì†Œê³„': 'CCTV_ì†Œê³„'})

# ì¸êµ¬ ì»¬ëŸ¼ì— POP_ prefix
merged = merged.rename(columns={'ì¸êµ¬': 'POP_ì¸êµ¬'})
```

**ìµœì¢… ê²°ê³¼**:
```
ê¸°ê´€ëª…    CCTV_ì†Œê³„    POP_ì¸êµ¬
ê°•ë‚¨êµ¬    2780         570500
ê°•ë™êµ¬    773          440359
...
```

#### 5.3 ë²”ì£„ ë°ì´í„° Merge

**ì£¼ì˜ì **: ë²”ì£„ ë°ì´í„°ëŠ” **ê²½ì°°ì„œ ë‹¨ìœ„**ì´ë¯€ë¡œ ìì¹˜êµ¬ì— ì—¬ëŸ¬ í–‰ì´ ë§¤ì¹­ë¨

```python
final_merged = self.method.df_merge(
    left=merged,           # CCTV + ì¸êµ¬ ë°ì´í„° (ìì¹˜êµ¬ ë‹¨ìœ„)
    right=crime_with_gu,   # ë²”ì£„ ë°ì´í„° (ê²½ì°°ì„œ ë‹¨ìœ„)
    left_on='ê¸°ê´€ëª…',       # ìì¹˜êµ¬
    right_on='ìì¹˜êµ¬',      # Kakao APIë¡œ ì°¾ì€ ìì¹˜êµ¬
    how='inner'
)
```

**ê²°ê³¼** (ê°•ë‚¨êµ¬ ì˜ˆì‹œ):
```
ìì¹˜êµ¬    CCTV_ì†Œê³„    POP_ì¸êµ¬    ê´€ì„œëª…              CRIME_ì‚´ì¸ ë°œìƒ
ê°•ë‚¨êµ¬    2780         570500      ì„œìš¸ê°•ë‚¨ê²½ì°°ì„œ      3
ê°•ë‚¨êµ¬    2780         570500      ì„œìš¸ìˆ˜ì„œê²½ì°°ì„œ      10
```

**ğŸ’¡ ì™œ CCTVì™€ ì¸êµ¬ê°€ ì¤‘ë³µë˜ë‚˜ìš”?**
- ê°•ë‚¨êµ¬ì— ê²½ì°°ì„œê°€ 2ê°œ â†’ 2ê°œ í–‰ ìƒì„±
- CCTVì™€ ì¸êµ¬ëŠ” ìì¹˜êµ¬ ë‹¨ìœ„ â†’ ê°™ì€ ê°’ ë°˜ë³µ
- ë‚˜ì¤‘ì— ìì¹˜êµ¬ë³„ë¡œ ì§‘ê³„í•  ë•Œ ì´ë¥¼ ê³ ë ¤í•´ì•¼ í•¨

---

### 6ë‹¨ê³„: ë°ì´í„° ì €ì¥ ë° ê²€ì¦

#### 6.1 CSV ì €ì¥í•˜ê¸°

```python
save_path = Path(self.data.sname) / 'crime.csv'
save_path.parent.mkdir(parents=True, exist_ok=True)  # save í´ë” ìƒì„±
final_merged.to_csv(save_path, index=False, encoding='utf-8-sig')
```

**ğŸ’¡ encoding='utf-8-sig'ë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ **:
- `utf-8`: í•œê¸€ ì €ì¥ ê°€ëŠ¥
- `sig`: BOM(Byte Order Mark) ì¶”ê°€
- ì—‘ì…€ì—ì„œ ì—´ ë•Œ í•œê¸€ì´ ê¹¨ì§€ì§€ ì•ŠìŒ

#### 6.2 Docker Volumeìœ¼ë¡œ íŒŒì¼ í™•ì¸í•˜ê¸°

**Volume ì„¤ì •** (`docker-compose.yaml`):
```yaml
mlservice:
  volumes:
    - ./ai.kroaddy.site/services/mlservice/app/seoul_crime/save:/app/app/seoul_crime/save
```

**ë™ì‘ ì›ë¦¬**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Docker Container    â”‚         â”‚  Host Machine        â”‚
â”‚                      â”‚         â”‚                      â”‚
â”‚  /app/app/          â”‚ <â”€â”€â”¬â”€â”€> â”‚  ./ai.kroaddy.site/ â”‚
â”‚  seoul_crime/save/   â”‚    â”‚    â”‚  services/mlservice/ â”‚
â”‚                      â”‚    â”‚    â”‚  app/seoul_crime/   â”‚
â”‚  crime.csv ìƒì„± â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜    â”‚  save/crime.csv      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê²€ì¦ ë°©ë²•**:
1. API í˜¸ì¶œ: `GET http://localhost:8080/api/ai/seoul/preprocess`
2. í„°ë¯¸ë„ ë¡œê·¸ í™•ì¸: `âœ“ ì •ì œí™”ëœ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤`
3. íŒŒì¼ í™•ì¸: `ai.kroaddy.site/services/mlservice/app/seoul_crime/save/crime.csv`
4. ì—‘ì…€ë¡œ ì—´ì–´ì„œ ë°ì´í„° í™•ì¸

---

## ğŸ“Š íˆíŠ¸ë§µ ìƒì„±

### 7ë‹¨ê³„: ë²”ì£„ìœ¨ ê³„ì‚°í•˜ê¸°

#### 7.1 ì™œ ë²”ì£„ìœ¨ì„ ê³„ì‚°í•˜ë‚˜ìš”?

**ë¬¸ì œì **: ì ˆëŒ€ ê±´ìˆ˜ë¡œëŠ” ê³µì •í•œ ë¹„êµê°€ ë¶ˆê°€ëŠ¥
- ê°•ë‚¨êµ¬ ì¸êµ¬: 570,500ëª…, ì ˆë„ 3,850ê±´
- ë„ë´‰êµ¬ ì¸êµ¬: 353,800ëª…, ì ˆë„ 1,214ê±´
- ë‹¨ìˆœ ë¹„êµ: "ê°•ë‚¨êµ¬ê°€ ë” ìœ„í—˜í•´ ë³´ì„"
- **í•˜ì§€ë§Œ**: ì¸êµ¬ê°€ ë§ìœ¼ë©´ ë²”ì£„ë„ ë§ì„ ìˆ˜ë°–ì— ì—†ìŒ

**í•´ê²°**: ì¸êµ¬ 10ë§Œëª…ë‹¹ ë²”ì£„ ë°œìƒ ê±´ìˆ˜ë¡œ ì •ê·œí™”
```
ë²”ì£„ìœ¨ = (ë²”ì£„ ë°œìƒ ê±´ìˆ˜ / ì¸êµ¬) * 100,000
```

#### 7.2 ë²”ì£„ìœ¨ ê³„ì‚° ë¡œì§

```python
def prepare_heatmap_data(self) -> dict:
    """ìì¹˜êµ¬ë³„ ë²”ì£„ìœ¨ ë° ê²€ê±°ìœ¨ ê³„ì‚°"""
    
    # 1ë‹¨ê³„: crime.csv ë¡œë“œ
    crime_df = pd.read_csv(save_path / 'crime.csv')
    
    # 2ë‹¨ê³„: ìì¹˜êµ¬ë³„ ì§‘ê³„ (ê²½ì°°ì„œê°€ ì—¬ëŸ¬ ê°œì¸ ìì¹˜êµ¬ ê³ ë ¤)
    grouped = crime_df.groupby('ìì¹˜êµ¬').agg({
        'POP_ì¸êµ¬': 'first',  # ì¸êµ¬ëŠ” ì²« ë²ˆì§¸ ê°’ (ëª¨ë‘ ë™ì¼)
        'CRIME_ì‚´ì¸ ë°œìƒ': 'sum',  # ë²”ì£„ ê±´ìˆ˜ëŠ” í•©ê³„
        'CRIME_ê°•ë„ ë°œìƒ': 'sum',
        'CRIME_ê°•ê°„ ë°œìƒ': 'sum',
        'CRIME_ì ˆë„ ë°œìƒ': 'sum',
        'CRIME_í­ë ¥ ë°œìƒ': 'sum',
        'CRIME_ì‚´ì¸ ê²€ê±°': 'sum',
        'CRIME_ê°•ë„ ê²€ê±°': 'sum',
        'CRIME_ê°•ê°„ ê²€ê±°': 'sum',
        'CRIME_ì ˆë„ ê²€ê±°': 'sum',
        'CRIME_í­ë ¥ ê²€ê±°': 'sum',
    }).reset_index()
    
    # 3ë‹¨ê³„: ë²”ì£„ìœ¨ ê³„ì‚° (ì¸êµ¬ 10ë§Œëª…ë‹¹)
    for crime_type in ['ì‚´ì¸', 'ê°•ë„', 'ê°•ê°„', 'ì ˆë„', 'í­ë ¥']:
        col_name = f'CRIME_{crime_type} ë°œìƒ'
        rate_col = f'{crime_type}ë°œìƒë¥ '
        grouped[rate_col] = (grouped[col_name] / grouped['POP_ì¸êµ¬'] * 100000).round(1)
    
    # 4ë‹¨ê³„: ê²€ê±°ìœ¨ ê³„ì‚° (%)
    for crime_type in ['ì‚´ì¸', 'ê°•ë„', 'ê°•ê°„', 'ì ˆë„', 'í­ë ¥']:
        ë°œìƒ_col = f'CRIME_{crime_type} ë°œìƒ'
        ê²€ê±°_col = f'CRIME_{crime_type} ê²€ê±°'
        rate_col = f'{crime_type}ê²€ê±°ìœ¨'
        grouped[rate_col] = (
            (grouped[ê²€ê±°_col] / grouped[ë°œìƒ_col] * 100)
            .fillna(0)  # 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²½ìš° 0ìœ¼ë¡œ ëŒ€ì²´
            .round(1)
        )
```

**ğŸ’¡ ìì¹˜êµ¬ë³„ ì§‘ê³„ê°€ ì¤‘ìš”í•œ ì´ìœ **:
ê°•ë‚¨êµ¬ì— ê°•ë‚¨ê²½ì°°ì„œ, ìˆ˜ì„œê²½ì°°ì„œê°€ ìˆìœ¼ë©´:
```
# ì§‘ê³„ ì „
ìì¹˜êµ¬    ì¸êµ¬      ì‚´ì¸ ë°œìƒ
ê°•ë‚¨êµ¬    570500    3
ê°•ë‚¨êµ¬    570500    10

# ì§‘ê³„ í›„
ìì¹˜êµ¬    ì¸êµ¬      ì‚´ì¸ ë°œìƒ
ê°•ë‚¨êµ¬    570500    13        â† 3 + 10 í•©ì‚°
```

#### 7.3 ê²€ê±°ìœ¨ ê³„ì‚° íŠ¹ìˆ˜ ì²˜ë¦¬

**ë¬¸ì œ**: ë°œìƒ ê±´ìˆ˜ê°€ 0ì´ë©´?
```python
ê²€ê±°ìœ¨ = ê²€ê±° ê±´ìˆ˜ / ë°œìƒ ê±´ìˆ˜ * 100
# ë°œìƒ 0ê±´ â†’ ZeroDivisionError ë˜ëŠ” NaN
```

**í•´ê²°**:
```python
.fillna(0)  # NaNì„ 0ìœ¼ë¡œ ëŒ€ì²´
```

**ì˜ë¯¸**: ë°œìƒ ê±´ìˆ˜ê°€ 0ì´ë©´ ê²€ê±°ìœ¨ë„ 0%ë¡œ í‘œì‹œ

---

### 8ë‹¨ê³„: Matplotlib/Seabornìœ¼ë¡œ íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°

#### 8.1 íˆíŠ¸ë§µì´ë€?

**íˆíŠ¸ë§µ(Heatmap)**: ë°ì´í„°ë¥¼ ìƒ‰ìƒìœ¼ë¡œ í‘œí˜„í•œ 2ì°¨ì› í‘œ
- Xì¶•: ë²”ì£„ ìœ í˜• (ì‚´ì¸, ê°•ë„, ê°•ê°„, ì ˆë„, í­ë ¥)
- Yì¶•: ìì¹˜êµ¬ (ê°•ë‚¨êµ¬, ê°•ë™êµ¬, ...)
- ìƒ‰ìƒ: ê°’ì˜ í¬ê¸° (ë¹¨ê°„ìƒ‰ = ë†’ìŒ, í•˜ì–€ìƒ‰/íŒŒë€ìƒ‰ = ë‚®ìŒ)

**ì¥ì **:
- í•œëˆˆì— íŒ¨í„´ íŒŒì•… ê°€ëŠ¥
- ìˆ˜ì¹˜ ë¹„êµê°€ ì§ê´€ì 
- ì´ìƒì¹˜(outlier) ì‰½ê²Œ ë°œê²¬

#### 8.2 í•œê¸€ í°íŠ¸ ì„¤ì • (ì¤‘ìš”!)

**ë¬¸ì œ**: ê¸°ë³¸ matplotlibëŠ” í•œê¸€ ë¯¸ì§€ì› â†’ â–¡â–¡â–¡ë¡œ í‘œì‹œ

**í•´ê²°**: Docker ì»¨í…Œì´ë„ˆì— í•œê¸€ í°íŠ¸ ì„¤ì¹˜

**Dockerfile ìˆ˜ì •**:
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# í•œê¸€ í°íŠ¸ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    fonts-nanum \          # ë‚˜ëˆ”í°íŠ¸
    fontconfig \           # í°íŠ¸ ì„¤ì • ë„êµ¬
    && rm -rf /var/lib/apt/lists/* \
    && fc-cache -fv        # í°íŠ¸ ìºì‹œ ì¬êµ¬ì„±
```

**Python ì½”ë“œì—ì„œ í°íŠ¸ ì„¤ì •** (`seoul_method.py`):
```python
import matplotlib.pyplot as plt
from matplotlib.font_manager import FontProperties
import platform
import os

def _setup_korean_font(self):
    """í•œê¸€ í°íŠ¸ ì„¤ì •"""
    plt.rcParams['axes.unicode_minus'] = False  # ë§ˆì´ë„ˆìŠ¤ ê¸°í˜¸ ê¹¨ì§ ë°©ì§€
    
    system = platform.system()
    if system == 'Windows':
        plt.rcParams['font.family'] = 'Malgun Gothic'
    elif system == 'Darwin':  # macOS
        plt.rcParams['font.family'] = 'AppleGothic'
    else:  # Linux (Docker)
        nanum_gothic_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
        if os.path.exists(nanum_gothic_path):
            prop = FontProperties(fname=nanum_gothic_path)
            plt.rcParams['font.family'] = 'NanumGothic'
            self._korean_font_prop = prop
```

**ğŸ’¡ ì™œ OSë³„ë¡œ ë‹¤ë¥´ê²Œ ì„¤ì •í•˜ë‚˜ìš”?**
- Windows: ë§‘ì€ ê³ ë”•(Malgun Gothic) ê¸°ë³¸ íƒ‘ì¬
- macOS: ì• í”Œê³ ë”•(AppleGothic) ê¸°ë³¸ íƒ‘ì¬
- Linux(Docker): í°íŠ¸ ì§ì ‘ ì„¤ì¹˜ í•„ìš”

#### 8.3 íˆíŠ¸ë§µ ìƒì„± ì½”ë“œ ë¶„ì„

```python
def create_crime_rate_heatmap(self, crime_rate_df: pd.DataFrame) -> BytesIO:
    """ë²”ì£„ìœ¨ íˆíŠ¸ë§µ ìƒì„±"""
    
    # 1ë‹¨ê³„: í•œê¸€ í°íŠ¸ ì„¤ì •
    self._setup_korean_font()
    
    # 2ë‹¨ê³„: ì»¬ëŸ¼ëª… ì§§ê²Œ ë³€ê²½ (ê°€ë…ì„± í–¥ìƒ)
    df_display = crime_rate_df.copy()
    column_short_names = {
        'ì‚´ì¸ë°œìƒë¥ ': 'ì‚´ì¸',
        'ê°•ë„ë°œìƒë¥ ': 'ê°•ë„',
        'ê°•ê°„ë°œìƒë¥ ': 'ê°•ê°„',
        'ì ˆë„ë°œìƒë¥ ': 'ì ˆë„',
        'í­ë ¥ë°œìƒë¥ ': 'í­ë ¥'
    }
    df_display = df_display.rename(columns=column_short_names)
    
    # 3ë‹¨ê³„: ì •ê·œí™” (0~1 ë²”ìœ„ë¡œ ë³€í™˜)
    # ì™œ? ë²”ì£„ ìœ í˜•ë§ˆë‹¤ ìŠ¤ì¼€ì¼ì´ ë‹¤ë¦„ (ì‚´ì¸: ~10, ì ˆë„: ~1000)
    # ì •ê·œí™”í•˜ë©´ ìƒ‰ìƒ ë¹„êµê°€ ê³µì •í•´ì§
    df_normalized = df_display.copy()
    for col in df_normalized.columns:
        col_max = df_normalized[col].max()
        col_min = df_normalized[col].min()
        if col_max > col_min:
            df_normalized[col] = (df_normalized[col] - col_min) / (col_max - col_min)
    
    # 4ë‹¨ê³„: ì •ë ¬ (ë²”ì£„ìœ¨ ë†’ì€ ìì¹˜êµ¬ê°€ ìœ„ë¡œ)
    df_normalized['Total'] = df_normalized.sum(axis=1)
    df_normalized = df_normalized.sort_values('Total', ascending=False)
    df_normalized = df_normalized.drop('Total', axis=1)
    
    # 5ë‹¨ê³„: Figure ìƒì„± (í¬ê¸° ì¡°ì ˆ)
    fig, ax = plt.subplots(figsize=(14, max(12, len(df_display) * 0.4)))
    
    # 6ë‹¨ê³„: Seaborn íˆíŠ¸ë§µ ê·¸ë¦¬ê¸°
    heatmap = sns.heatmap(
        df_normalized,      # ìƒ‰ìƒìš© ë°ì´í„° (0~1 ì •ê·œí™”)
        annot=df_display,   # í‘œì‹œí•  ìˆ«ì (ì‹¤ì œ ê°’)
        fmt='.1f',          # ì†Œìˆ˜ì  1ìë¦¬
        cmap='Reds',        # ë¹¨ê°„ìƒ‰ ê³„ì—´ ìƒ‰ìƒë§µ
        cbar_kws={'label': 'ì •ê·œí™”ëœ ê°’ (0.0 ~ 1.0)', 'shrink': 0.8},
        linewidths=0.8,     # ì…€ ê²½ê³„ì„  ë‘ê»˜
        linecolor='white',  # ê²½ê³„ì„  ìƒ‰ìƒ
        square=False,       # ì…€ì„ ì •ì‚¬ê°í˜•ìœ¼ë¡œ ë§Œë“¤ì§€ ì•ŠìŒ
        ax=ax,
        annot_kws={'size': 9, 'weight': 'bold', 'color': 'white'},
        xticklabels=False,  # í‹± ë¼ë²¨ ìˆ¨ê¹€ (ë‚˜ì¤‘ì— ìˆ˜ë™ ì„¤ì •)
        yticklabels=False
    )
    
    # 7ë‹¨ê³„: í•œê¸€ í°íŠ¸ë¡œ í‹± ë¼ë²¨ ì„¤ì •
    font_prop = self._korean_font_prop
    ax.set_xticks(range(len(df_normalized.columns)))
    ax.set_xticklabels(df_normalized.columns.tolist(), 
                      fontproperties=font_prop, fontsize=11, rotation=0)
    ax.set_yticks(range(len(df_normalized.index)))
    ax.set_yticklabels(df_normalized.index.tolist(), 
                      fontproperties=font_prop, fontsize=10, rotation=0)
    
    # 8ë‹¨ê³„: ì œëª©ê³¼ ë¼ë²¨ ì„¤ì •
    ax.set_title('ì„œìš¸ì‹œ ë²”ì£„ìœ¨ íˆíŠ¸ë§µ (ì¸êµ¬ 10ë§Œëª…ë‹¹)', 
                fontsize=18, fontweight='bold', pad=25, fontproperties=font_prop)
    ax.set_xlabel('ë²”ì£„ ìœ í˜•', fontsize=14, fontweight='bold', fontproperties=font_prop)
    ax.set_ylabel('ìì¹˜êµ¬', fontsize=14, fontweight='bold', fontproperties=font_prop)
    
    # 9ë‹¨ê³„: ë ˆì´ì•„ì›ƒ ì¡°ì •
    plt.tight_layout()
    
    # 10ë‹¨ê³„: PNG ì´ë¯¸ì§€ë¡œ ì €ì¥ (BytesIO)
    buffer = BytesIO()
    plt.savefig(buffer, format='png', dpi=200, bbox_inches='tight', facecolor='white')
    buffer.seek(0)
    plt.close(fig)  # ë©”ëª¨ë¦¬ í•´ì œ
    
    return buffer
```

**ğŸ’¡ í•µì‹¬ ê°œë… ì„¤ëª…**:

**1. ì •ê·œí™” (Normalization)**
```python
# Before: ì‚´ì¸(~10), ì ˆë„(~1000) â†’ ìƒ‰ìƒ ë¹„êµ ë¶ˆê°€ëŠ¥
# After: ëª¨ë‘ 0~1 ë²”ìœ„ â†’ ê³µì •í•œ ë¹„êµ

normalized = (ê°’ - ìµœì†Œê°’) / (ìµœëŒ€ê°’ - ìµœì†Œê°’)
```

**2. annot vs ìƒ‰ìƒ ë°ì´í„° ë¶„ë¦¬**
```python
sns.heatmap(
    df_normalized,    # ìƒ‰ìƒ: 0~1 ì •ê·œí™” ê°’
    annot=df_display  # ìˆ«ì: ì‹¤ì œ ë²”ì£„ìœ¨ ê°’
)
```
- ì‚¬ìš©ìëŠ” ì‹¤ì œ ê°’ì„ ë³´ì§€ë§Œ
- ìƒ‰ìƒì€ ì •ê·œí™”ëœ ê°’ìœ¼ë¡œ í‘œí˜„
- **ì¥ì **: ìŠ¤ì¼€ì¼ì´ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ê³µì •í•˜ê²Œ ë¹„êµ

**3. BytesIO ì‚¬ìš©**
```python
buffer = BytesIO()  # ë©”ëª¨ë¦¬ìƒì˜ íŒŒì¼
plt.savefig(buffer, format='png')
buffer.seek(0)  # ì»¤ì„œë¥¼ ì²˜ìŒìœ¼ë¡œ ì´ë™
return buffer
```
- ë””ìŠ¤í¬ì— íŒŒì¼ ì €ì¥ ë¶ˆí•„ìš”
- FastAPI StreamingResponseë¡œ ì§ì ‘ ì „ì†¡
- ë©”ëª¨ë¦¬ íš¨ìœ¨ì 

#### 8.4 FastAPI ì—”ë“œí¬ì¸íŠ¸

```python
@router.get("/heatmap/crime-rate")
async def get_crime_rate_heatmap():
    """ë²”ì£„ìœ¨ íˆíŠ¸ë§µ ì´ë¯¸ì§€ ë°˜í™˜"""
    try:
        image_bytes = seoul_service.get_crime_rate_heatmap_image()
        return StreamingResponse(
            BytesIO(image_bytes),
            media_type="image/png",
            headers={"Content-Disposition": "inline; filename=crime_rate_heatmap.png"}
        )
    except Exception as e:
        import traceback
        error_detail = f"{str(e)}\n{traceback.format_exc()}"
        raise HTTPException(status_code=500, detail=error_detail)
```

**ğŸ’¡ StreamingResponseë€?**
- íŒŒì¼ì„ í•œ ë²ˆì— ë¡œë“œí•˜ì§€ ì•Šê³  ìŠ¤íŠ¸ë¦¬ë°ìœ¼ë¡œ ì „ì†¡
- ëŒ€ìš©ëŸ‰ íŒŒì¼ì— ìœ ë¦¬
- ë¸Œë¼ìš°ì €ì—ì„œ ì´ë¯¸ì§€ ì§ì ‘ í‘œì‹œ ê°€ëŠ¥

**í…ŒìŠ¤íŠ¸ ë°©ë²•**:
1. Postman: `GET http://localhost:8080/api/ai/seoul/heatmap/crime-rate`
2. ë¸Œë¼ìš°ì €: ìœ„ URL ì§ì ‘ ì ‘ì† â†’ ì´ë¯¸ì§€ í‘œì‹œ
3. HTML: `<img src="http://localhost:8080/api/ai/seoul/heatmap/crime-rate" />`

---

## ğŸ“ í•™ìŠµ ì •ë¦¬

### ì½”ë”© ìŠ¤íƒ€ì¼ ê°œì„ 

#### 1. ê°„ê²°í•œ Property/Setter
**Before** (ì§€ì–‘):
```python
@property
def cctv(self) -> pd.DataFrame:
    return self._cctv

@cctv.setter
def cctv(self, cctv):
    self._cctv = cctv
```

**After** (ì„ í˜¸):
```python
@property
def cctv(self) -> pd.DataFrame: return self._cctv

@cctv.setter
def cctv(self, cctv): self._cctv = cctv
```

**ì´ìœ **: ê°„ë‹¨í•œ ë¡œì§ì€ í•œ ì¤„ë¡œ ì‘ì„± â†’ ê°€ë…ì„± í–¥ìƒ

#### 2. List Comprehension í™œìš©
**Before**:
```python
station_names = []
for name in crime['ê´€ì„œëª…']:
    station_names.append('ì„œìš¸' + str(name[:-1]) + 'ê²½ì°°ì„œ')
```

**After**:
```python
station_names = ['ì„œìš¸' + str(name[:-1]) + 'ê²½ì°°ì„œ' for name in crime['ê´€ì„œëª…']]
```

**ì´ìœ **: 
- ì½”ë“œê°€ ì§§ê³  ì½ê¸° ì‰¬ì›€
- ì„±ëŠ¥ë„ ì•½ê°„ í–¥ìƒ

#### 3. ê²½ë¡œ ì„¤ì • Best Practice
**Before**:
```python
_DATA_PATH = Path(__file__).parent / 'data'
_dname: str = str(_DATA_PATH)
```

**After**:
```python
_dname: str = str(Path(__file__).parent / 'data')
```

**ì´ìœ **: ì¤‘ê°„ ë³€ìˆ˜ ë¶ˆí•„ìš” â†’ ì½”ë“œ ê°„ê²°í™”

---

### í•µì‹¬ ê°œë… ì •ë¦¬

#### 1. OOP ë ˆì´ì–´ ë¶„ë¦¬
```
Router (API ì—”ë“œí¬ì¸íŠ¸)
   â†“
Service (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
   â†“
Method (ë°ì´í„° ì²˜ë¦¬)
   â†“
Data (ë°ì´í„° ì €ì¥ì†Œ)
```

**ì¥ì **:
- í…ŒìŠ¤íŠ¸ ìš©ì´
- ìœ ì§€ë³´ìˆ˜ í¸í•¨
- ì½”ë“œ ì¬ì‚¬ìš©ì„± ë†’ìŒ

#### 2. API Gateway íŒ¨í„´
```
Client â†’ Gateway(8080) â†’ Service(9006)
```

**ì¥ì **:
- ë‹¨ì¼ ì§„ì…ì 
- ë³´ì•ˆ ê°•í™”
- ë¡œê¹…/ëª¨ë‹ˆí„°ë§ ì¤‘ì•™í™”

#### 3. Singleton íŒ¨í„´
```python
# ì—¬ëŸ¬ ë²ˆ í˜¸ì¶œí•´ë„ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤
gmaps1 = KakaoMapSingleton()
gmaps2 = KakaoMapSingleton()
# gmaps1 is gmaps2 â†’ True
```

**ì‚¬ìš© ì‹œê¸°**:
- API í´ë¼ì´ì–¸íŠ¸
- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
- ì„¤ì • ê´€ë¦¬

#### 4. DataFrame Merge ì „ëµ
```python
# Inner Join: êµì§‘í•© (ë°ì´í„° í’ˆì§ˆ ìš°ì„ )
merge(left, right, how='inner')  âœ…

# Left Join: ì™¼ìª½ ê¸°ì¤€ (ë°ì´í„° ì™„ì „ì„± ìš°ì„ )
merge(left, right, how='left')

# Outer Join: í•©ì§‘í•© (ëª¨ë“  ë°ì´í„° ìœ ì§€)
merge(left, right, how='outer')
```

#### 5. ë°ì´í„° ì •ê·œí™”
```python
# Min-Max Normalization (0~1 ë²”ìœ„)
normalized = (x - min) / (max - min)

# Z-Score Normalization (í‘œì¤€ì •ê·œë¶„í¬)
normalized = (x - mean) / std
```

**ì–¸ì œ ì‚¬ìš©?**
- ìŠ¤ì¼€ì¼ì´ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ í•¨ê»˜ ì‹œê°í™”í•  ë•Œ
- ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ í•™ìŠµ ì „

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

### ë¬¸ì œ 1: 404 Not Found - API ì—”ë“œí¬ì¸íŠ¸ ë¯¸ì‘ë™

**ì¦ìƒ**:
```bash
GET http://localhost:8080/api/ai/seoul/preprocess
â†’ 404 Not Found
```

**ì›ì¸ ë¶„ì„**:
1. API Gatewayì— ë¼ìš°íŒ… ê·œì¹™ì´ ì—†ìŒ
2. Serviceê°€ ì‹¤í–‰ë˜ì§€ ì•ŠìŒ
3. URL ê²½ë¡œê°€ ì˜ëª»ë¨

**í•´ê²° ê³¼ì •**:

**Step 1**: Gateway ì„¤ì • í™•ì¸
```yaml
# application.yaml í™•ì¸
- id: seoul-service-route
  uri: http://mlservice:9006
  predicates:
    - Path=/api/ai/seoul/**
  filters:
    - RewritePath=/api/ai/seoul/(?<segment>.*), /seoul/${segment}
```

**Step 2**: Service ì‹¤í–‰ í™•ì¸
```bash
docker compose ps
# mlserviceê°€ "running" ìƒíƒœì—¬ì•¼ í•¨
```

**Step 3**: Gateway ì¬ì‹œì‘
```bash
docker compose restart api-gateway
```

**ê²€ì¦**:
```bash
# 1. ì§ì ‘ ì ‘ê·¼ í…ŒìŠ¤íŠ¸ (Gateway ì—†ì´)
curl http://localhost:9006/seoul/preprocess

# 2. Gateway ì ‘ê·¼ í…ŒìŠ¤íŠ¸
curl http://localhost:8080/api/ai/seoul/preprocess
```

---

### ë¬¸ì œ 2: Missing openpyxl - Excel íŒŒì¼ ì½ê¸° ì‹¤íŒ¨

**ì¦ìƒ**:
```
ModuleNotFoundError: Missing optional dependency 'openpyxl'
Use pip install openpyxl to use this method
```

**ì™œ ë°œìƒí–ˆë‚˜ìš”?**
- PandasëŠ” Excel íŒŒì¼ ì½ê¸°ì— `openpyxl` ë¼ì´ë¸ŒëŸ¬ë¦¬ í•„ìš”
- `pd.read_excel()` í˜¸ì¶œ ì‹œ ìë™ìœ¼ë¡œ `openpyxl` ì„í¬íŠ¸ ì‹œë„
- `requirements.txt`ì— ëª…ì‹œ ì•ˆ í•˜ë©´ Docker ì´ë¯¸ì§€ì— ë¯¸í¬í•¨

**í•´ê²°**:
```txt
# requirements.txtì— ì¶”ê°€
openpyxl>=3.1.0
xlrd>=2.0.1  # êµ¬í˜• Excel íŒŒì¼(.xls)ë„ ì§€ì›
```

**Docker ì¬ë¹Œë“œ**:
```bash
docker compose build mlservice
docker compose up -d mlservice
```

**ğŸ’¡ Tip**: `requirements.txt` ë³€ê²½ í›„ í•­ìƒ ì¬ë¹Œë“œ í•„ìš”

---

### ë¬¸ì œ 3: í„°ë¯¸ë„ ë¡œê·¸ ë¯¸ì¶œë ¥

**ì¦ìƒ**:
- API í˜¸ì¶œì€ ì„±ê³µí•˜ì§€ë§Œ
- ê²½ì°°ì„œ ì£¼ì†Œ ê²€ìƒ‰ ë¡œê·¸ê°€ ë³´ì´ì§€ ì•ŠìŒ

**ì›ì¸**:
```python
# logger.info()ëŠ” ë¡œê·¸ ë ˆë²¨ì— ë”°ë¼ ì¶œë ¥ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ
logger.info(f"âœ“ {name}ì˜ ê²€ìƒ‰ ê²°ê³¼: {addr}")  # ì•ˆ ë³´ì„
```

**í•´ê²°**:
```python
# print()ëŠ” ë¬´ì¡°ê±´ stdoutì— ì¶œë ¥
print(f"âœ“ {name}ì˜ ê²€ìƒ‰ ê²°ê³¼: {addr}")  # ë³´ì„
```

**Docker ë¡œê·¸ í™•ì¸ ë°©ë²•**:
```bash
# ì‹¤ì‹œê°„ ë¡œê·¸ í™•ì¸
docker compose logs -f mlservice

# ìµœê·¼ 100ì¤„ í™•ì¸
docker compose logs --tail=100 mlservice
```

**ğŸ’¡ ê°œë°œ ì‹œì—ëŠ” `print()`ê°€ ë” ìœ ìš©**

---

### ë¬¸ì œ 4: save/crime.csv íŒŒì¼ì´ í˜¸ìŠ¤íŠ¸ì—ì„œ ì•ˆ ë³´ì„

**ì¦ìƒ**:
- API í˜¸ì¶œ: "ì •ì œí™”ëœ ë°ì´í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤" âœ“
- í•˜ì§€ë§Œ í˜¸ìŠ¤íŠ¸ `save/` í´ë”ì— íŒŒì¼ ì—†ìŒ

**ì›ì¸ ì´í•´**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Docker Container â”‚       â”‚ Host Machine     â”‚
â”‚                  â”‚       â”‚                  â”‚
â”‚ /app/app/        â”‚   X   â”‚ ./ai.kroaddy.    â”‚
â”‚ seoul_crime/     â”‚       â”‚ site/services/   â”‚
â”‚ save/crime.csv   â”‚       â”‚ mlservice/...    â”‚
â”‚ (ì—¬ê¸°ì—ë§Œ ì €ì¥ë¨)â”‚       â”‚ (íŒŒì¼ ì—†ìŒ)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•´ê²°**: Volume ë§ˆìš´íŠ¸ ì¶”ê°€

```yaml
# docker-compose.yaml
mlservice:
  volumes:
    - ./ai.kroaddy.site/services/mlservice/app/seoul_crime/save:/app/app/seoul_crime/save
```

**ê²€ì¦**:
```bash
# 1. Volume ë§ˆìš´íŠ¸ í™•ì¸
docker compose config | grep -A 5 volumes

# 2. ì»¨í…Œì´ë„ˆ ë‚´ë¶€ íŒŒì¼ í™•ì¸
docker compose exec mlservice ls -la /app/app/seoul_crime/save

# 3. í˜¸ìŠ¤íŠ¸ì—ì„œ íŒŒì¼ í™•ì¸
ls -la ai.kroaddy.site/services/mlservice/app/seoul_crime/save
```

**ğŸ’¡ Volumeì„ ì¶”ê°€/ë³€ê²½í•œ í›„ì—ëŠ” ì»¨í…Œì´ë„ˆ ì¬ì‹œì‘ í•„ìš”**

---

### ë¬¸ì œ 5: Kakao Map API ê²€ìƒ‰ ì‹¤íŒ¨

**ì¦ìƒ**:
```
âœ— ì„œìš¸ê°•ë‚¨ê²½ì°°ì„œ: ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤
```

**ì›ì¸ 1**: ì˜ëª»ëœ API ì—”ë“œí¬ì¸íŠ¸
```python
# Address Search API (ì£¼ì†Œ ê²€ìƒ‰ìš©) - ê²½ì°°ì„œ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ ì•ˆ ë¨ âŒ
url = "https://dapi.kakao.com/v2/local/search/address.json"
```

**í•´ê²° 1**:
```python
# Keyword Search API (í‚¤ì›Œë“œ ê²€ìƒ‰ìš©) - ì¥ì†Œëª…ìœ¼ë¡œ ê²€ìƒ‰ ê°€ëŠ¥ âœ…
url = "https://dapi.kakao.com/v2/local/search/keyword.json"
```

**ì›ì¸ 2**: API í‚¤ ë¯¸ì„¤ì •
```bash
# .env íŒŒì¼ í™•ì¸
cat .env | grep KAKAO_REST_API_KEY
# â†’ ê°’ì´ ì—†ê±°ë‚˜ ì˜ëª»ë¨
```

**í•´ê²° 2**:
```bash
# .env íŒŒì¼ì— ì¶”ê°€
KAKAO_REST_API_KEY=your_actual_api_key_here

# Docker Compose ì¬ì‹œì‘
docker compose down
docker compose up -d
```

**ê²€ì¦**:
```python
# Docker ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ í™˜ê²½ë³€ìˆ˜ í™•ì¸
docker compose exec mlservice env | grep KAKAO
```

---

### ë¬¸ì œ 6: íˆíŠ¸ë§µ í•œê¸€ì´ ê¹¨ì§ (â–¡â–¡â–¡ë¡œ í‘œì‹œ)

**ì¦ìƒ**:
- íˆíŠ¸ë§µ ì´ë¯¸ì§€ëŠ” ìƒì„±ë¨
- í•˜ì§€ë§Œ í•œê¸€ì´ â–¡â–¡â–¡ ë˜ëŠ” ?ë¡œ í‘œì‹œ

**ì›ì¸**:
- matplotlib ê¸°ë³¸ í°íŠ¸ëŠ” í•œê¸€ ë¯¸ì§€ì›
- Docker Linux í™˜ê²½ì— í•œê¸€ í°íŠ¸ ë¯¸ì„¤ì¹˜

**í•´ê²° ê³¼ì •**:

**Step 1**: Dockerfileì— í•œê¸€ í°íŠ¸ ì„¤ì¹˜
```dockerfile
RUN apt-get update && apt-get install -y \
    fonts-nanum \
    fontconfig \
    && rm -rf /var/lib/apt/lists/* \
    && fc-cache -fv
```

**Step 2**: Python ì½”ë“œì—ì„œ í°íŠ¸ ì„¤ì •
```python
def _setup_korean_font(self):
    nanum_gothic_path = '/usr/share/fonts/truetype/nanum/NanumGothic.ttf'
    if os.path.exists(nanum_gothic_path):
        prop = FontProperties(fname=nanum_gothic_path)
        plt.rcParams['font.family'] = 'NanumGothic'
        self._korean_font_prop = prop
```

**Step 3**: íˆíŠ¸ë§µ ìƒì„± ì‹œ í°íŠ¸ ëª…ì‹œì  ì ìš©
```python
# í‹± ë¼ë²¨ì— í°íŠ¸ ì ìš©
ax.set_xticklabels(columns, fontproperties=font_prop)
ax.set_yticklabels(index, fontproperties=font_prop)

# ì œëª©ê³¼ ë¼ë²¨ì— í°íŠ¸ ì ìš©
ax.set_title('ì„œìš¸ì‹œ ë²”ì£„ìœ¨ íˆíŠ¸ë§µ', fontproperties=font_prop)
```

**Step 4**: Docker ì¬ë¹Œë“œ
```bash
docker compose build mlservice
docker compose restart mlservice
```

**ê²€ì¦**:
```bash
# 1. í°íŠ¸ íŒŒì¼ í™•ì¸
docker compose exec mlservice ls -la /usr/share/fonts/truetype/nanum/

# 2. Pythonì—ì„œ í°íŠ¸ ë¡œë“œ í…ŒìŠ¤íŠ¸
docker compose exec mlservice python -c "
from matplotlib.font_manager import FontProperties
prop = FontProperties(fname='/usr/share/fonts/truetype/nanum/NanumGothic.ttf')
print(f'Font loaded: {prop.get_name()}')
"

# 3. API í˜¸ì¶œí•´ì„œ ì´ë¯¸ì§€ í™•ì¸
curl http://localhost:8080/api/ai/seoul/heatmap/crime-rate > test.png
```

**ğŸ’¡ í•µì‹¬**: Dockerfile ë³€ê²½ â†’ `--build` ì˜µì…˜ìœ¼ë¡œ ì¬ë¹Œë“œ í•„ìˆ˜

---

### ë¬¸ì œ 7: Docker ë¹Œë“œ ìºì‹œ ë¬¸ì œ

**ì¦ìƒ**:
- ì½”ë“œë¥¼ ìˆ˜ì •í–ˆëŠ”ë° ë³€ê²½ì‚¬í•­ì´ ë°˜ì˜ ì•ˆ ë¨
- ì´ì „ ë²„ì „ ì½”ë“œê°€ ê³„ì† ì‹¤í–‰ë¨

**ì›ì¸**:
- DockerëŠ” ë¹Œë“œ ì†ë„ í–¥ìƒì„ ìœ„í•´ ë ˆì´ì–´ ìºì‹œ ì‚¬ìš©
- `COPY` ëª…ë ¹ì–´ì˜ íŒŒì¼ì´ ë³€ê²½ë˜ì§€ ì•Šìœ¼ë©´ ìºì‹œ ì‚¬ìš©

**í•´ê²°**:

**ë°©ë²• 1**: `--build` í”Œë˜ê·¸ë¡œ ì¬ë¹Œë“œ
```bash
docker compose up -d --build mlservice
```

**ë°©ë²• 2**: ìºì‹œ ë¬´ì‹œí•˜ê³  ì™„ì „ ì¬ë¹Œë“œ
```bash
docker compose build --no-cache mlservice
docker compose up -d mlservice
```

**ë°©ë²• 3**: ì»¨í…Œì´ë„ˆ ì™„ì „íˆ ì‚­ì œ í›„ ì¬ìƒì„±
```bash
docker compose down
docker compose up -d --build
```

**ğŸ’¡ ì–¸ì œ ì¬ë¹Œë“œê°€ í•„ìš”í•œê°€?**
- âœ… `Dockerfile` ë³€ê²½
- âœ… `requirements.txt` ë³€ê²½
- âœ… í°íŠ¸ ì„¤ì¹˜ ë“± ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ë³€ê²½
- âŒ Python ì½”ë“œë§Œ ë³€ê²½ (Volume ë§ˆìš´íŠ¸ë˜ì–´ ìˆìœ¼ë©´ ì¬ë¹Œë“œ ë¶ˆí•„ìš”)

---

## ğŸ“Š ìµœì¢… ê²°ê³¼ë¬¼

### API ì—”ë“œí¬ì¸íŠ¸ ëª©ë¡

| Method | Endpoint | ì„¤ëª… | ë°˜í™˜ í˜•ì‹ |
|--------|----------|------|----------|
| GET | `/api/ai/seoul/top5` | ê° ë°ì´í„°ì˜ ìƒìœ„ 5ê°œ | JSON |
| GET | `/api/ai/seoul/preprocess` | ë°ì´í„° ì „ì²˜ë¦¬ ë° í†µí•© | JSON |
| GET | `/api/ai/seoul/heatmap/crime-rate` | ë²”ì£„ìœ¨ íˆíŠ¸ë§µ ì´ë¯¸ì§€ | PNG |
| GET | `/api/ai/seoul/heatmap/arrest-rate` | ê²€ê±°ìœ¨ íˆíŠ¸ë§µ ì´ë¯¸ì§€ | PNG |
| GET | `/api/ai/seoul/heatmap/data` | íˆíŠ¸ë§µ ì›ë³¸ ë°ì´í„° | JSON |

### ì‚¬ìš© ì˜ˆì‹œ

**1. ë°ì´í„° ì „ì²˜ë¦¬ ì‹¤í–‰**:
```bash
curl -X GET http://localhost:8080/api/ai/seoul/preprocess
```

**2. ë²”ì£„ìœ¨ íˆíŠ¸ë§µ ë³´ê¸°** (ë¸Œë¼ìš°ì €):
```
http://localhost:8080/api/ai/seoul/heatmap/crime-rate
```

**3. Postmanìœ¼ë¡œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ**:
- Method: GET
- URL: `http://localhost:8080/api/ai/seoul/heatmap/arrest-rate`
- Send â†’ Preview íƒ­ì—ì„œ ì´ë¯¸ì§€ í™•ì¸

**4. HTMLì—ì„œ ì‚¬ìš©**:
```html
<img src="http://localhost:8080/api/ai/seoul/heatmap/crime-rate" 
     alt="ì„œìš¸ì‹œ ë²”ì£„ìœ¨ íˆíŠ¸ë§µ" />
```

### ìƒì„±ëœ íŒŒì¼

**`save/crime.csv`** (í†µí•© ë°ì´í„°):
```csv
ìì¹˜êµ¬,CCTV_ì†Œê³„,POP_ì¸êµ¬,ê´€ì„œëª…,CRIME_ì‚´ì¸ ë°œìƒ,CRIME_ì‚´ì¸ ê²€ê±°,...,ê²½ì°°ì„œì£¼ì†Œ
ê°•ë‚¨êµ¬,2780,570500,ì„œìš¸ê°•ë‚¨ê²½ì°°ì„œ,3,3,...,ì„œìš¸ ê°•ë‚¨êµ¬ ëŒ€ì¹˜ë™ 998
ê°•ë‚¨êµ¬,2780,570500,ì„œìš¸ìˆ˜ì„œê²½ì°°ì„œ,10,7,...,ì„œìš¸ ê°•ë‚¨êµ¬ ê°œí¬ë™ 14
ê°•ë™êµ¬,773,440359,ì„œìš¸ê°•ë™ê²½ì°°ì„œ,3,3,...,ì„œìš¸ ê°•ë™êµ¬ ì„±ë‚´ë™ 301
...
```

**ì»¬ëŸ¼ ì„¤ëª…**:
- `ìì¹˜êµ¬`: ì„œìš¸ì‹œ 25ê°œ ìì¹˜êµ¬
- `CCTV_ì†Œê³„`: ìì¹˜êµ¬ë³„ CCTV ì„¤ì¹˜ ëŒ€ìˆ˜
- `POP_ì¸êµ¬`: ìì¹˜êµ¬ ì´ ì¸êµ¬ìˆ˜
- `ê´€ì„œëª…`: ê²½ì°°ì„œ ì´ë¦„ (ì„œìš¸XXê²½ì°°ì„œ í˜•ì‹)
- `CRIME_XX ë°œìƒ`: 5ëŒ€ ë²”ì£„ ë°œìƒ ê±´ìˆ˜
- `CRIME_XX ê²€ê±°`: 5ëŒ€ ë²”ì£„ ê²€ê±° ê±´ìˆ˜
- `ê²½ì°°ì„œì£¼ì†Œ`: Kakao Map APIë¡œ ê²€ìƒ‰í•œ ê²½ì°°ì„œ ì£¼ì†Œ

### ë°ì´í„° í†µê³„

```
ì›ë³¸ ë°ì´í„°:
â”œâ”€ CCTV ë°ì´í„°: 25ê°œ ìì¹˜êµ¬
â”œâ”€ ì¸êµ¬ ë°ì´í„°: 25ê°œ ìì¹˜êµ¬
â””â”€ ë²”ì£„ ë°ì´í„°: 31ê°œ ê²½ì°°ì„œ

í†µí•© í›„:
â””â”€ ìµœì¢… ë°ì´í„°: 29ê°œ í–‰ (ê²½ì°°ì„œ ë‹¨ìœ„)
   â”œâ”€ ì¼ë¶€ ìì¹˜êµ¬ëŠ” ê²½ì°°ì„œ 2ê°œ (ê°•ë‚¨êµ¬, ì„œì´ˆêµ¬ ë“±)
   â””â”€ Inner Joinìœ¼ë¡œ ë¶ˆì™„ì „í•œ ë°ì´í„° ì œì™¸
```

---

## ğŸ“ ë‹¤ìŒ í•™ìŠµ ê³¼ì œ

### 1. ë°ì´í„° ì‹œê°í™” ê³ ë„í™”
- [ ] Foliumì„ ì‚¬ìš©í•œ ì§€ë„ ìœ„ íˆíŠ¸ë§µ (Choropleth Map)
- [ ] ê²½ì°°ì„œ ìœ„ì¹˜ì— ë§ˆì»¤ í‘œì‹œ (Popupìœ¼ë¡œ í†µê³„ í‘œì‹œ)
- [ ] ë²”ì£„ìœ¨ê³¼ CCTV ìˆ˜ì˜ ìƒê´€ê´€ê³„ ì‚°ì ë„
- [ ] ì‹œê³„ì—´ ë¶„ì„ (ì—°ë„ë³„ ë²”ì£„ ì¶”ì´)

### 2. ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ êµ¬ì¶•
- [ ] CCTV ìˆ˜ì™€ ë²”ì£„ ë°œìƒ ê±´ìˆ˜ì˜ ê´€ê³„ ë¶„ì„ (íšŒê·€ ë¶„ì„)
- [ ] ì¸êµ¬, CCTV, ìœ„ì¹˜ ì •ë³´ë¡œ ë²”ì£„ìœ¨ ì˜ˆì¸¡
- [ ] Feature Engineering (ì¸êµ¬ ë°€ë„, CCTV ë°€ë„ ë“±)
- [ ] ëª¨ë¸ í‰ê°€ (RMSE, RÂ² Score)

### 3. API ê°œì„ 
- [ ] í˜ì´ì§€ë„¤ì´ì…˜ ì¶”ê°€ (`?page=1&size=10`)
- [ ] í•„í„°ë§ ê¸°ëŠ¥ (`?district=ê°•ë‚¨êµ¬&crime_type=ì ˆë„`)
- [ ] ì •ë ¬ ê¸°ëŠ¥ (`?sort_by=crime_rate&order=desc`)
- [ ] ìºì‹± ì ìš© (Redis) - íˆíŠ¸ë§µ ì´ë¯¸ì§€ëŠ” ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ
- [ ] API ë¬¸ì„œ ìë™í™” (Swagger UI)

### 4. í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™
- [ ] React/Vue.jsë¡œ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
- [ ] ìì¹˜êµ¬ í´ë¦­ ì‹œ ìƒì„¸ í†µê³„ í‘œì‹œ
- [ ] ë²”ì£„ ìœ í˜•ë³„ í•„í„°ë§ UI
- [ ] íˆíŠ¸ë§µ ì¸í„°ë™í‹°ë¸Œ íˆ´íŒ

### 5. ë°ì´í„° ì—…ë°ì´íŠ¸ ìë™í™”
- [ ] ì •ê¸°ì ìœ¼ë¡œ ìµœì‹  ë°ì´í„° í¬ë¡¤ë§ (Celery + Beat)
- [ ] ë°ì´í„° ë³€ê²½ ì‹œ íˆíŠ¸ë§µ ìë™ ì¬ìƒì„±
- [ ] ì´ë©”ì¼/Slack ì•Œë¦¼

---

## ğŸ”— ì°¸ê³  ìë£Œ ë° ë” ë°°ìš°ê¸°

### ê³µì‹ ë¬¸ì„œ
- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com/) - í•œê¸€ ë²ˆì—­ ìˆìŒ
- [Pandas ê³µì‹ ë¬¸ì„œ](https://pandas.pydata.org/docs/)
- [Matplotlib ê³µì‹ ë¬¸ì„œ](https://matplotlib.org/stable/contents.html)
- [Seaborn ê³µì‹ íŠœí† ë¦¬ì–¼](https://seaborn.pydata.org/tutorial.html)
- [Kakao Map API ê°€ì´ë“œ](https://developers.kakao.com/docs/latest/ko/local/dev-guide)
- [Spring Cloud Gateway](https://spring.io/projects/spring-cloud-gateway)
- [Docker Compose ê³µì‹ ë¬¸ì„œ](https://docs.docker.com/compose/)

### ì¶”ì²œ í•™ìŠµ ìë£Œ
- **Pandas ë§ˆìŠ¤í„°í•˜ê¸°**: [10 Minutes to Pandas](https://pandas.pydata.org/docs/user_guide/10min.html)
- **ë°ì´í„° ì‹œê°í™”**: [Python Graph Gallery](https://python-graph-gallery.com/)
- **API ë””ìì¸**: [RESTful API Design Best Practices](https://restfulapi.net/)
- **Docker ì…ë¬¸**: [Docker Get Started](https://docs.docker.com/get-started/)

### ìœ ìš©í•œ ë„êµ¬
- **API í…ŒìŠ¤íŠ¸**: [Postman](https://www.postman.com/), [Insomnia](https://insomnia.rest/)
- **ë°ì´í„° ì‹œê°í™”**: [Plotly](https://plotly.com/python/), [Altair](https://altair-viz.github.io/)
- **ë¡œê·¸ ëª¨ë‹ˆí„°ë§**: [Grafana](https://grafana.com/), [ELK Stack](https://www.elastic.co/elastic-stack)

---

## ğŸ¯ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ ê²ƒ

### ê¸°ìˆ ì  ìŠ¤í‚¬
âœ… FastAPIë¡œ RESTful API ì„¤ê³„ ë° êµ¬í˜„  
âœ… Pandasë¡œ ë³µì¡í•œ ë°ì´í„° ì „ì²˜ë¦¬ ë° í†µí•©  
âœ… Matplotlib/Seabornìœ¼ë¡œ í†µê³„ íˆíŠ¸ë§µ ìƒì„±  
âœ… Docker Composeë¡œ ë©€í‹° ì»¨í…Œì´ë„ˆ ì• í”Œë¦¬ì¼€ì´ì…˜ êµ¬ì„±  
âœ… API Gateway íŒ¨í„´ìœ¼ë¡œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í†µí•©  
âœ… ì™¸ë¶€ API(Kakao Map) ì—°ë™ ë° ë°ì´í„° ì¶”ì¶œ  
âœ… í•œê¸€ í°íŠ¸ ì²˜ë¦¬ ë° êµ­ì œí™” ì´ìŠˆ í•´ê²°  

### ì†Œí”„íŠ¸ ìŠ¤í‚¬
âœ… ë¬¸ì œ ë¶„ì„ ë° í•´ê²° ëŠ¥ë ¥ (íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)  
âœ… ì½”ë“œ ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ì„± ê³ ë ¤  
âœ… ë°ì´í„° í’ˆì§ˆ ê´€ë¦¬ (ê²°ì¸¡ì¹˜, ì´ìƒì¹˜ ì²˜ë¦¬)  
âœ… í”„ë¡œì íŠ¸ êµ¬ì¡°í™” (OOP, ë ˆì´ì–´ ë¶„ë¦¬)  
âœ… ë¬¸ì„œí™” ëŠ¥ë ¥ (README ì‘ì„±)  

### ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸
ğŸ’¡ ë°ì´í„° ì •ê·œí™”ì˜ ì¤‘ìš”ì„± (ê³µì •í•œ ë¹„êµ)  
ğŸ’¡ ì‹œê°í™”ë¥¼ í†µí•œ íŒ¨í„´ ë°œê²¬  
ğŸ’¡ API ì„¤ê³„ ì‹œ ì‚¬ìš©ì ê²½í—˜ ê³ ë ¤  
ğŸ’¡ ì¸í”„ë¼ ìë™í™”ì˜ íš¨ìœ¨ì„±  

---

**ì‘ì„±ì¼**: 2024ë…„ 12ì›” 11ì¼  
**ì‘ì„±ì**: AI Assistant & Student  
**í”„ë¡œì íŠ¸**: ì„œìš¸ ë²”ì£„ ë°ì´í„° ë¶„ì„ ë° ì‹œê°í™” ì‹œìŠ¤í…œ  
**ë²„ì „**: 2.0 - íˆíŠ¸ë§µ ìƒì„± ì™„ë£Œ  

**ë‹¤ìŒ ë‹¨ê³„**: ì§€ë„ ì‹œê°í™” ë° ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ êµ¬ì¶• ğŸš€

